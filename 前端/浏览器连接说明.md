## 捕获浏览器事件日志

在chrome地址栏输入`chrome://net-internals/#events`。+号对应事件开始，-号对应事件结束，必然成对出现。(时间均以毫秒计)

- 日志第一列：时间线，自请求发起时算。

- 日志第二列：每步操作所逝去的时间，时间差的概念(和第三列里面的dt不同，它会积累前面的耗时)。

- 日志第三列：具体的事件，以及相应事件的耗时dt，此耗时为绝对耗时。

## chrome缓存锁机制

浏览器对一个资源发起请求前，会先检查本地缓存(此时这个请求对该资源对应缓存的读写是独占的)。如果后面又有对该资源发起请求，该请求也会去读取该缓存，但是该缓存被独占，后面的请求无法获取对该缓存的操作权限，就会处于等待状态。

后面的请求默认被设定了一个读取缓存超时的时限，超过这个时限则认为该缓存不可用或者本地无缓存，忽略这一步直接向服务器发起请求。

## chrome dev tool中请求的时间线，各阶段代表的意义

- Stalled/Blocking：请求被发送出去前的时间。(包含处理代理的时间；如果有已经建立好的连接，这阶段还包括等待已建立连接被复用的时间；遵循对同一源最大6个TCP连接的规则)

- Proxy Negotiation：处理代理的事件。

- DNS Lookup：查找DNS的时间。(页面上的每个新的域， 都需要一次完整的寻路来完成DNS查找)

- Initial Connection / Connecting：用于建立连接的时间，包括TCP握手以及多次尝试握手，还有处理SSL

- SSL：完成SSL握手的事件。

- Request Sent / Sending：发起请求的事件，通常小到可以忽略。

- Waiting (TTFB)：等待响应的时间(等待返回首个字节的时间)。包含了与服务器之间一个来回响应的时间，和等待首个字节被返回的时间。

- Content Download / Downloading：用于下载响应的时间。


## TCP连接可能被重置的情况

- SMB Reset：如果服务器提供多个端口，客户端同时去请求多个端口连接，服务器返回多个端口都可用，此时客户端择优选择一个进行连接，重置另一个。

- Ack Reset：服务器没有监听被请求的端口，无法建立连接；或者服务器此刻无法或者没有充裕资源来建立连接。

- TCP Reset due to no response：没有响应而被重置，当发起连接的一方连续发送6次请求未得到回应，此时默认他们已经通过三次握手建立了连接，并且通信有问题，发起的一方将连接重置。

- Application Reset：应用层将连接重置，可能是由程序内部逻辑重置，也可能是由其他错误导致。
